<!-- check_request.html -->

{% extends "pages/base7.html" %}
{% load static %}

{% block title %}ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header">
      <h1>ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</h1>
      <p class="subtitle">ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ÙˆØ§Ù„Ù…Ù„ÙØ§Øª Ù‚Ø¨Ù„ Ø§Ù„ØªØ£ÙƒÙŠØ¯</p>
    </div>

    <div class="info-grid">
      <div class="section">
        <h2>Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h2>
        <ul>
          <li><strong>Ø§Ù„Ù„Ù‚Ø¨: </strong> {{ client.family_name }}</li>
          <li><strong>Ø§Ù„Ø§Ø³Ù…: </strong> {{ client.full_name }}</li>
          <li><strong>Ø§Ù„ÙˆÙ„Ø§ÙŠØ©:</strong> {{ client.state }}</li>
          <li><strong>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</strong> {{ client.phone_number }}</li>
          <li><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:</strong> {{ client.birthday }}</li>
          <li><strong>Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ÙˆØ·Ù†ÙŠ:</strong> {{ client.nin_number }}</li>
          <li><strong>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> {{ service.created_at|date:"d/m/Y H:i" }}</li>
          <li><strong>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©:</strong> {{ service.get_service_type_display }}</li>
        </ul>
      </div>

      <div class="section">
        <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h2>
        <textarea readonly>{{ service.additional_text }}</textarea>

        {% if service.uploaded_file %}
          <div class="file-upload">
            ğŸ“ <a href="{{ service.uploaded_file.url }}" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ø±ÙÙˆØ¹</a>
          </div>
        {% endif %}
      </div>
    </div>

    <form method="post" id="validation-form">
      {% csrf_token %}

      <div id="rejection-reason" style="display:none; margin-top:15px;">
        <label for="reason">Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶ :</label><br>
        <textarea name="reason" rows="4" cols="50" placeholder="Ø§Ø´Ø±Ø­ Ø³Ø¨Ø¨ Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨..."></textarea>
      </div>

      <div class="actions" style="margin-top:15px;">
        <button type="submit" name="accept" class="btn validate">ØªØ£ÙƒÙŠØ¯</button>
        <button type="submit" name="reject" class="btn reject" onclick="showReason(event)">Ø±ÙØ¶</button>
      </div>
    </form>
  </div>

  <script>
    function showReason(event) {
      // Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù†Øµ Ù„Ø³Ø¨Ø¨ Ø§Ù„Ø±ÙØ¶
      document.getElementById('rejection-reason').style.display = 'block';

      // Ù…Ù†Ø¹ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ÙÙˆØ±ÙŠ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬
      event.preventDefault();

      // ØªØºÙŠÙŠØ± Ø²Ø± Ø§Ù„Ø±ÙØ¶ Ù„ÙŠÙ‚ÙˆÙ… Ø¨Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ø¹Ø¯ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø³Ø¨Ø¨
      const form = document.getElementById('validation-form');
      const rejectBtn = event.target;
      rejectBtn.onclick = null; // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø­Ø¯Ø« Ø§Ù„Ø­Ø§Ù„ÙŠ Ù„Ù…Ù†Ø¹ Ø§Ù„ØªÙƒØ±Ø§Ø±
      rejectBtn.innerText = "ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø±ÙØ¶";
      rejectBtn.type = "submit";
    }
  </script>
{% endblock %}
